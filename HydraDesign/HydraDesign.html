<html><head><title>Hydra Design</title><style type="text/css">ol{margin:0;padding:0}.c23{vertical-align:top;width:177pt;border-style:solid;border-color:#cccccc;border-width:1pt;padding:5pt 10pt 5pt 10pt}.c4{vertical-align:top;width:120.8pt;border-style:solid;border-color:#cccccc;border-width:1pt;padding:5pt 10pt 5pt 10pt}.c20{vertical-align:top;width:174pt;border-style:solid;border-color:#cccccc;border-width:1pt;padding:5pt 10pt 5pt 10pt}.c24{vertical-align:top;width:225pt;border-style:solid;border-color:#cccccc;border-width:1pt;padding:5pt 10pt 5pt 10pt}.c7{vertical-align:top;width:122.2pt;border-style:solid;border-color:#cccccc;border-width:1pt;padding:5pt 10pt 5pt 10pt}.c8{vertical-align:top;width:117pt;border-style:solid;border-color:#cccccc;border-width:1pt;padding:5pt 10pt 5pt 10pt}.c12{color:#666666;font-size:12pt;font-family:"Trebuchet MS";text-decoration:underline}.c27{list-style-type:lower-latin;margin:0;padding:0}.c26{list-style-type:decimal;margin:0;padding:0}.c22{list-style-type:circle;margin:0;padding:0}.c28{max-width:538.6pt;background-color:#ffffff;padding:56.7pt 38.3pt 56.7pt 35.1pt}.c5{list-style-type:disc;margin:0;padding:0}.c17{line-height:1.5;padding-top:11pt;padding-bottom:11pt}.c6{padding-left:0pt;margin-left:72pt}.c13{padding-left:0pt;margin-left:36pt}.c25{margin:5px;border:1px solid black}.c11{color:#333333;background-color:#ffffff}.c19{border-collapse:collapse}.c1{line-height:1.0}.c18{text-align:center}.c3{height:0pt}.c21{text-decoration:underline}.c9{height:12pt}.c2{height:11pt}.c14{background-color:#ffff00}.c15{font-size:13pt}.c10{font-weight:bold}.c0{direction:ltr}.c16{background-color:#ff0000}.title{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:21pt;font-family:"Trebuchet MS";padding-bottom:0pt}.subtitle{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:13pt;font-family:"Trebuchet MS";padding-bottom:10pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:16pt;font-family:"Trebuchet MS";padding-bottom:0pt}h2{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:13pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h3{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h4{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;text-decoration:underline;font-family:"Trebuchet MS";padding-bottom:0pt}h5{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}h6{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}</style></head><body class="c28"><p class="c0 title"><a name="h.aqule8t7wzct"></a><span>Hydra Concept</span></p><p class="c0"><span>Multi-cloud application discovery, management and balancing.</span></p><p class="c2 c0"><span></span></p><p class="c0 c18"><img height="662" src="images/image00.png" width="734"></p><p class="c2 c0 title"><a name="h.v6kbufg9zj8g"></a></p><hr style="page-break-before:always;display:none;"><p class="c2 c0 title"><a name="h.779v7hnsxs3r"></a></p><p class="c0 title"><a name="h.4nl9kb97qp36"></a><span>Architecture</span></p><p class="c18 c0"><img height="843" src="images/image01.png" width="626"></p><p class="c0 title"><a name="h.7hhj5ikt4htj"></a><span>Implementation</span></p><h1 class="c0"><a name="h.hwmx7vgdt0ky"></a><span>App Manager</span></h1><p class="c0"><span>The app manager is in charge of check and monitor one or several servers and update the status information at one or several Hydra Servers using the restful server AP.</span></p><p class="c2 c0"><span></span></p><p class="c0"><span>The basic functionality is to notify to one Hydra Server when an application is Started, Stopping, or Removed. In addition, it will provide information about the server health status like CPU and memory usage and any useful information like the size of the server or the prefered balance strategy.</span></p><p class="c2 c0"><span></span></p><p class="c0"><span>All these information should be updated periodically. If not, the hydra server will assume that the servers are shutted down. Timing parameters should be consider between &ldquo;App Manager&rdquo; and &ldquo;Monitor&rdquo; components.</span></p><h1 class="c0"><a name="h.6vubxq3qwl4t"></a><span>Hydra Server</span></h1><h2 class="c0"><a name="h.yt731lg2srsh"></a><span>Client API (Rest)</span></h2><p class="c0"><span>This module will expose a basic restful api for Hydra Client.</span></p><p class="c2 c0"><span></span></p><a href="#" name="c543b4099cfeeff8d170beeaefe01302295bd80a"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c19"><tbody><tr><td class="c8"><p class="c17 c0"><span class="c11 c10">Operation</span></p></td><td class="c20"><p class="c0 c17"><span class="c10 c11">HTTP action</span></p></td><td class="c23"><p class="c17 c0"><span class="c11 c10">Description</span></p></td></tr><tr><td class="c8"><p class="c1 c0"><span>Find a server/s for a given appID.</span></p></td><td class="c20"><p class="c1 c0"><span>GET /app/{appID}</span></p></td><td class="c23"><p class="c1 c0"><span>Response example: [&ldquo;http://bbva.com/api&rdquo;]</span></p><p class="c1 c0"><span>Code 200 on success.</span></p><p class="c1 c0"><span>Code 500 on error.</span></p><p class="c1 c0"><span>*Maybe add some info about local balancing</span></p></td></tr><tr class="c3"><td class="c8"><p class="c1 c0"><span>Get the list of active hydra servers. Including itself.</span></p></td><td class="c20"><p class="c1 c0"><span>GET /hydra</span></p></td><td class="c23"><p class="c1 c0"><span>Response example:</span></p><p class="c1 c0"><span>[</span></p><p class="c1 c0"><span>&ldquo;http://hydra1.com:5000&rdquo;,</span></p><p class="c1 c0"><span>&ldquo;http://hydra2.com:6000&rdquo;</span></p><p class="c1 c0"><span>]</span></p><p class="c1 c0"><span>Code 200 on success.</span></p><p class="c1 c0"><span>Code 500 on error.</span></p></td></tr></tbody></table><h2 class="c0"><a name="h.mw7t35z23fe0"></a><span>Server API (Rest)</span></h2><p class="c0"><span>This module will expose a complete restful api for App Managers and other Hydra servers.</span></p><p class="c2 c0"><span></span></p><a href="#" name="00d92dbb4ba9cf88444ec3939b4546dd84d6db72"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c19"><tbody><tr class="c3"><td class="c4"><p class="c17 c0"><span class="c11 c10">Operation</span></p></td><td class="c7"><p class="c17 c0"><span class="c11 c10">HTTP action</span></p></td><td class="c24"><p class="c17 c0"><span class="c11 c10">Description</span></p></td></tr><tr class="c3"><td class="c4"><p class="c1 c0"><span>Register or update an app</span></p></td><td class="c7"><p class="c1 c0"><span>POST /app/{appID}</span></p></td><td class="c24"><p class="c1 c0"><span>Post data example:</span></p><p class="c1 c0"><span>{</span></p><p class="c1 c0"><span>&nbsp; &ldquo;localStrategyEvents&rdquo;: {...},</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cloudStrategyEvents&rdquo;: {...},</span></p><p class="c1 c0"><span>&nbsp; &quot;servers&quot;:[</span></p><p class="c1 c0"><span>&nbsp; &nbsp; {</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &quot;server&quot;:&quot;http://bbva.com/api&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &quot;status&quot;:&quot;statusStrut&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &ldquo;cost&rdquo;: 3,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &ldquo;cloud&rdquo;: &ldquo;amazon&rdquo;</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp;}</span></p><p class="c1 c0"><span>&nbsp; &nbsp;]</span></p><p class="c1 c0"><span>&nbsp;}</span></p><p class="c1 c0"><span>Code 200 on success.</span></p><p class="c0 c1"><span>Code 500 on error.</span></p></td></tr><tr class="c3"><td class="c4"><p class="c1 c0"><span>Get all apps</span></p></td><td class="c7"><p class="c1 c0"><span>GET /app/</span></p></td><td class="c24"><p class="c1 c0"><span>Response example:</span></p><p class="c1 c0"><span>[{</span></p><p class="c1 c0"><span>&ldquo;appID&rdquo;: &ldquo;app1&rdquo;,</span></p><p class="c1 c0"><span>&ldquo;localStrategy&rdquo;: {...},</span></p><p class="c1 c0"><span>&ldquo;cloudStrategy&rdquo;: {...},</span></p><p class="c1 c0"><span>&ldquo;servers&rdquo;: [{ </span></p><p class="c1 c0"><span>&nbsp; &ldquo;server&rdquo;: &ldquo;http://bbva.com/api&rdquo;,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;status&rdquo;: statusStrut,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cost&rdquo;: 3,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cloud&rdquo;: &ldquo;amazon&rdquo;</span></p><p class="c1 c0"><span>&nbsp; }, { </span></p><p class="c1 c0"><span>&nbsp; &ldquo;server&rdquo;: &ldquo;http://bbva.es/api&rdquo;,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;status&rdquo;: statusStrut,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cost&rdquo;: 3,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cloud&rdquo;: &ldquo;amazon&rdquo;,</span></p><p class="c1 c0"><span>}] }]</span></p><p class="c1 c0"><span>Code 200 on success.</span></p><p class="c1 c0"><span>Code 500 on error.</span></p></td></tr><tr class="c3"><td class="c4"><p class="c1 c0"><span>Get one app</span></p></td><td class="c7"><p class="c1 c0"><span>GET /app/{appID}</span></p></td><td class="c24"><p class="c1 c0"><span>Response example:</span></p><p class="c1 c0"><span>[{</span></p><p class="c1 c0"><span>&ldquo;appID&rdquo;: &ldquo;app1&rdquo;,</span></p><p class="c1 c0"><span>&ldquo;localStrategy&rdquo;: {...},</span></p><p class="c1 c0"><span>&ldquo;cloudStrategy&rdquo;: {...},</span></p><p class="c1 c0"><span>&ldquo;servers&rdquo;: [{ </span></p><p class="c1 c0"><span>&nbsp; &ldquo;server&rdquo;: &ldquo;http://bbva.com/api&rdquo;,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;status&rdquo;: statusStrut,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cost&rdquo;: 3,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cloud&rdquo;: &ldquo;amazon&rdquo;</span></p><p class="c1 c0"><span>&nbsp; }, { </span></p><p class="c1 c0"><span>&nbsp; &ldquo;server&rdquo;: &ldquo;http://bbva.es/api&rdquo;,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;status&rdquo;: statusStrut,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cost&rdquo;: 3,</span></p><p class="c1 c0"><span>&nbsp; &ldquo;cloud&rdquo;: &ldquo;amazon&rdquo;</span></p><p class="c1 c0"><span>}] }]</span></p><p class="c1 c0"><span>Code 200 on success.</span></p><p class="c1 c0"><span>Code 500 on error.</span></p></td></tr></tbody></table><p class="c2 c0"><span></span></p><p class="c0"><span>localStrategyEnum= {</span></p><p class="c0"><span>&nbsp; &nbsp; INDIFFERENT: 0,</span></p><p class="c0"><span>&nbsp; &nbsp; ROUND_ROBIN: 1,</span></p><p class="c0"><span>&nbsp; &nbsp; SERVER_LOAD: 2,</span></p><p class="c0"><span>&nbsp; &nbsp; CHEAPEST: 3</span></p><p class="c0"><span>}</span></p><p class="c2 c0"><span></span></p><p class="c0"><span>cloudStrategyEnum= {</span></p><p class="c0"><span>&nbsp; &nbsp; INDIFFERENT: 0,</span></p><p class="c0"><span>&nbsp; &nbsp; ROUND_ROBIN: 1,</span></p><p class="c0"><span>&nbsp; &nbsp; CHEAPEST: 2,</span></p><p class="c0"><span>&nbsp; &nbsp; CLOUD_LOAD: 3</span></p><p class="c0"><span>}</span></p><p class="c2 c0"><span></span></p><p class="c0"><span>stateEnum = {<br> &nbsp; &nbsp;READY: 0,<br> &nbsp; &nbsp;UNAVAILABLE : 1<br>}</span></p><p class="c1 c0 c2"><span></span></p><p class="c1 c0"><span>statusStrut is used for provide information about both hydra servers and app servers. Example:</span></p><p class="c1 c0"><span>{</span></p><p class="c1 c0"><span>&nbsp; &nbsp; cpuLoad: 50, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Cpu load of the server 0-100</span></p><p class="c1 c0"><span>&nbsp; &nbsp; memLoad: 50, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Memory load of the server 0-100</span></p><p class="c1 c0"><span>&nbsp; &nbsp; timeStamp: 42374897239&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//UTC time stamp of this info</span></p><p class="c1 c0"><span>&nbsp; &nbsp; stateEvents: {</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &ldquo;42374897239&rdquo;: stateEnum.READY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Future state of the serve. The key is a time stamp</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1 c0"><span>&nbsp; &nbsp; }</span></p><p class="c1 c0"><span>}</span></p><p class="c1 c2 c0"><span></span></p><h2 class="c1 c0"><a name="h.w3x8wzvzaz6f"></a><span>Balancing A.I</span></h2><p class="c0"><span>This module will retrieve and filter data from DAO according to predefined balancing patterns. &nbsp;</span></p><h3 class="c0"><a name="h.sikklvlv9zj6"></a><span>function find(appID, requestParams)</span></h3><p class="c0"><span>Return an adequate server for given appID. All balancing stuff is doing here and should be transparent for invoker.</span></p><h3 class="c0"><a name="h.sjp0cm51szd"></a><span>function active(requestParams)</span></h3><p class="c0"><span>Return the list of active hydra servers. Including itself. This list can be sorted or filtered according to received request params or hydra server status. These params could be request IP or user id for example.</span></p><h2 class="c0"><a name="h.2dtzywd6plrt"></a><span>DAO</span></h2><p class="c0"><span>This module will provide all necessary functions to store and retrieve persistent data.</span></p><p class="c0"><span>The natural choice for database engine is MongoDB or another not relational DDBB. Even Redis with persistence could be a good choice.</span></p><p class="c0"><span>There will be one big collection: &ldquo;</span><span class="c10">apps</span><span>&rdquo;. Example::</span></p><p class="c2 c0"><span></span></p><p class="c1 c0"><span>[</span></p><p class="c1 c0"><span>&nbsp; &nbsp;{</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &quot;appID&quot;:&quot;app1&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &ldquo;localStrategyEvents&rdquo;: {</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&ldquo;42374897239&rdquo;: localStrategyEnum.SERVER_LOAD //Prefered local balance strategy. Key is time stamp</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp;}</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &ldquo;cloudStrategyEvents&rdquo;: {</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&ldquo;42374897239&rdquo;: cloudStrategyEnum.CHEAPEST //Prefered cloud balance strategy. Key is time stamp</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp;}</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &quot;servers&quot;:[</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;server&quot;:&quot;http://bbva.com/api&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;status&quot;:&quot;statusStrut&quot;,</span></p><p class="c1 c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&ldquo;cost&rdquo;: 5,</span></p><p class="c1 c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&ldquo;cloud&rdquo;: &ldquo;google&rdquo;</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;server&quot;:&quot;http://bbva.es/api&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;status&quot;:&quot;statusStrut&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &ldquo;cost&rdquo;: 3,</span></p><p class="c1 c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&ldquo;cloud&rdquo;: &ldquo;google&rdquo;</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; ]</span></p><p class="c1 c0"><span>&nbsp; &nbsp;},</span></p><p class="c1 c0"><span>&nbsp; &nbsp;{</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &quot;appID&quot;:&quot;app2&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &quot;servers&quot;:[</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;server&quot;:&quot;http://bbva.com/api&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;status&quot;:&quot;statusStrut&quot;,</span></p><p class="c1 c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&ldquo;cost&rdquo;: 4,</span></p><p class="c1 c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&ldquo;cloud&rdquo;: &ldquo;amazon&rdquo;</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;server&quot;:&quot;http://bbva.es/api&quot;,</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;status&quot;:&quot;statusStrut&quot;,</span></p><p class="c1 c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&ldquo;cost&rdquo;: 2,</span></p><p class="c1 c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&ldquo;cloud&rdquo;: &ldquo;amazon&rdquo;</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></p><p class="c1 c0"><span>&nbsp; &nbsp; &nbsp; ]</span></p><p class="c1 c0"><span>&nbsp; &nbsp;}</span></p><p class="c1 c0"><span>]</span></p><p class="c1 c2 c0"><span></span></p><p class="c1 c0"><span>In addition we need to store hydra servers info (Including itseft). Hydra servers will be stored as another app with the name &ldquo;</span><span class="c10">hydra</span><span>&rdquo;.</span></p><h3 class="c1 c0"><a name="h.vpf9tnitjbwy"></a><span>CRUD for &ldquo;apps&rdquo;</span></h3><p class="c2 c0"><span></span></p><p class="c0"><span class="c10 c16">TODO: Explain logic of get and update that goes here</span></p><hr style="page-break-before:always;display:none;"><p class="c2 c0"><span class="c16"></span></p><p class="c0"><span class="c10 c15">Get &amp; Update Logic</span></p><p class="c0"><span>Every time a client or synchronization request an application, this app goes through a cleanup and update process.</span></p><p class="c2 c0"><span></span></p><p class="c0"><span>The update process start with this steps:</span></p><ol class="c26" start="1"><li class="c13 c0"><span>The new events are added to the localStrategyEvents and cloudStrategyEvents objects. The structure is { &lt;timestamp&gt; : &lt;state&gt; }</span></li><li class="c13 c0"><span>This objects are sorted in ascending order of timestamp.</span></li><li class="c13 c0"><span>Server information is merged adding new servers if they were not present in the servers object, otherwise the information of the server is merged based on the timestamp. </span></li></ol><ol class="c27" start="1"><li class="c6 c0"><span>The stateEvents structure is merged &ldquo;as is&rdquo; and sorted.</span></li><li class="c6 c0"><span>Any other field is added to the structure but the status field.</span></li><li class="c6 c0"><span>Timestamp of the status field is checked to know if the information we have is old or not, and merged in case it&rsquo;s more recent.</span></li></ol><ol class="c26" start="4"><li class="c13 c0"><span>Once all this information is merged or created, the whole structure is cleaned up, leaving only the least recent events and all the futures events.</span></li></ol><p class="c2 c0"><span class="c16"></span></p><h2 class="c0"><a name="h.kuoit8hyq9xv"></a><span>Server Sync</span></h2><p class="c0"><span>The responsibility of this module is to synchronize information with other hydra servers. To accomplish that, it will periodically ask for information to other known hydra servers and fusion it with it own information.</span></p><p class="c2 c0"><span></span></p><p class="c0"><span>An Hydra server will ask to all the Hydra servers registered in it&rsquo;s local database and follow the same procedure described above for all the apps retrieved.</span></p><p class="c2 c0"><span class="c14"></span></p><h2 class="c1 c0"><a name="h.8d2uxyghwqy9"></a><span>Monitor (Like App Manager for Hydras)</span></h2><p class="c0"><span>Monitor is an AppManager configured for monitor hydra process and inform itself.</span></p><h2 class="c0"><a name="h.vek6ueol9o3r"></a><span>Main</span></h2><p class="c0"><span>var dao = new Dao();</span></p><p class="c0"><span>var balancingAI = new BalancingAI(dao)</span></p><p class="c0"><span>var clientApi = new ClientApi(balancingAI)</span></p><p class="c0"><span>var serverSync = new ServerSync(dao)</span></p><p class="c0"><span>var serverApi = new ServerApi(dao, serverSync)</span></p><h1 class="c0"><a name="h.thxwnajl2b94"></a><span>Hydra Client</span></h1><p class="c0"><span class="c10 c16">TODO: Update this section</span></p><p class="c0"><span>Hydra client is a js file that should be included in the web page or node project. It provides two functions:</span></p><p class="c2 c0"><span></span></p><p class="c0"><span class="c10 c12">function hydra.config([&lt;server list&gt;], options)</span></p><ol class="c5" start="1"><li class="c13 c0"><span>[&lt;server list&gt;] - the initial servers we want to use to access Hydra.</span></li><li class="c13 c0"><span>options - (optional) object containing the following fields:</span></li></ol><ol class="c22" start="1"><li class="c0 c6"><span>hydraTimeOut - timeout for updating Hydra Servers. Minimum of 60 seconds</span></li><li class="c6 c0"><span>appTimeOut - timeout for updating an app server in the internal cache. Minimum 20 seconds</span></li><li class="c6 c0"><span>retryOnFail - retry timeout in case the hydra we are requesting an app or new Hydra servers fail to answer. Minimum 500ms</span></li></ol><p class="c2 c0"><span></span></p><p class="c0"><span>By default, the initial Hydra server will be the host serving the Hydra client file, making this function call optional on the browser, although it&rsquo;s recommended to set up the servers.</span></p><h3 class="c0 c9"><a name="h.fmjud52lly7b"></a></h3><h3 class="c0"><a name="h.u6vyskoivqlq"></a><span class="c21">function hydra.get(appID, nocache, callback)</span></h3><p class="c0"><span>This function will call to callback(error, [servers]) function with the url of the server that provides the given appID.</span></p><ol class="c5" start="1"><li class="c13 c0"><span>appID - id of the application requested</span></li><li class="c13 c0"><span>nocache - boolean, if set to true will ask the hydra server for the application servers ignoring the internal cache.</span></li><li class="c0 c13"><span>callback(error, [servers]) - function callback that will receive the app server or an error in case the app does not exist</span></li></ol><p class="c2 c0"><span></span></p><p class="c0"><span>Internally, it will ask to the first Hydra server or use the internal cache in order to get the corresponding server url for the app and then it will call to callback function. If the application exist, the servers are sent back and served through the callback function (if the application exist, but there are no servers available, it will return an empty array). If the application does not exist, the callback will receive an error and the list will be set to null.</span></p><p class="c2 c0"><span></span></p><p class="c0"><span>In case an Hydra server fails to answer (when requesting an app or new Hydra servers), the client will try again (based on the retryOnFail timeout) using the next server and moving the one that failed to the end of the list until one of the Hydra servers replies.</span></p><p class="c2 c0"><span></span></p><h4 class="c0"><a name="h.raivu0om7ayh"></a><span>Example of use with pooling every minute</span></h4><p class="c2 c0"><span></span></p><p class="c0"><span>var app1url = []</span></p><p class="c0"><span>var interval = setInterval(hydra.get(app1id, false, function(data) { app1url = data }, 60000)</span></p><p class="c0"><span>&hellip;</span></p><p class="c0"><span>$.ajax({</span></p><p class="c0"><span>&nbsp; url: app1url[0] ,</span></p><p class="c0"><span>&nbsp; sucess: {</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp;&hellip;.</span></p><p class="c0"><span>&nbsp; });</span></p><h4 class="c0"><a name="h.22k6e46kz3xg"></a><span>Example of use renewing server url only on error</span></h4><p class="c2 c0"><span></span></p><p class="c0"><span>var retry = 0</span></p><p class="c0"><span>var NUM_RETRIES = 2</span></p><p class="c0"><span>hydra(app1id, false, myfunction);</span></p><p class="c0"><span>myfunction(app1url) {</span></p><p class="c0"><span>&nbsp; $.ajax({</span></p><p class="c0"><span>&nbsp; &nbsp; url: app1url[0] ,</span></p><p class="c0"><span>&nbsp; &nbsp; sucess: {</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; retry = 0;</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; ...</span></p><p class="c0"><span>&nbsp; &nbsp; },</span></p><p class="c0"><span>&nbsp; &nbsp; error: {</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; if (retry&lt;NUM_RETRIES ) {</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; hydra.get(app1id, true, myfunction);</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; retry++;</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span>&nbsp; &nbsp; }</span></p><p class="c0"><span>&nbsp; });</span></p><p class="c0"><span>}</span></p><p class="c2 c0"><span></span></p><h1 class="c0"><a name="h.zh8ojq1gmok"></a><span>Future work</span></h1><h3 class="c0"><a name="h.gvpmr3fkp8r6"></a><span>ServerSync</span></h3><p class="c0"><span>In addition, it could actively inform to other servers for important notices in relation with apps or itself.</span></p><p class="c2 c0"><span></span></p><p class="c0"><span>The synchronization is limited to siblings servers but it could use a not sibling server in case of failures or special situations.</span><sup><a href="#cmnt1" name="cmnt_ref1">[a]</a></sup></p><p class="c2 c0"><span></span></p><p class="c0"><span>Server Sync has also a public interface for Server Api and Monitor. This interface allow to ServerSync to immediately realize about certain events and act as a consequence.</span></p><h3 class="c0"><a name="h.vr8t93o7enfx"></a><span>function registerAppEvent(appID, serverURL, status)</span></h3><h3 class="c0"><a name="h.tcctd0af4kx1"></a><span>function deleteAppEvent(appID, serverURL)</span></h3><h3 class="c0"><a name="h.xjryzkxeksy0"></a><span>function updateHydraStatus(url, status, publicKey</span><sup><a href="#cmnt2" name="cmnt_ref2">[b]</a></sup></h3><h3 class="c0"><a name="h.g1rbk6ykyco6"></a><span>Monitor</span></h3><h3 class="c0"><a name="h.ticekmdu65s0"></a><span>Responsibility: periodically update this hydra server status: CPU, memory, etc.</span></h3><p class="c0"><span>In addition it could invoke some Server Sync function in order to propagate some important information.</span><sup><a href="#cmnt3" name="cmnt_ref3">[c]</a></sup></p><p class="c2 c0"><span></span></p><p class="c0"><span>App Dao</span></p><p class="c0"><span>Change the server object from an array to an object indexed by server url to identify faster if a server does already exist.</span></p><p class="c0"><span>Group servers by cloud for faster cloud balancing</span></p><div class="c25"><p class="c1 c0"><a href="#cmnt_ref1" name="cmnt1">[a]</a><span>Germ&aacute;n Ramos Garc&iacute;a:</span></p><p class="c1 c0"><span>Sibling feature is not implemented</span></p></div><div class="c25"><p class="c1 c0"><a href="#cmnt_ref2" name="cmnt2">[b]</a><span>Germ&aacute;n Ramos Garc&iacute;a:</span></p><p class="c1 c0"><span>This funtcions are not developed yet since they are not necessary in a small scenario.</span></p></div><div class="c25"><p class="c1 c0"><a href="#cmnt_ref3" name="cmnt3">[c]</a><span>Germ&aacute;n Ramos Garc&iacute;a:</span></p><p class="c1 c0"><span>The monitor component can be replaced by an app-manager for hydra service. In this case, hydra would be a service by itself and it would take the advantages of balancing like other services. If it is used like that, the hydra collection would not be needed any more and server-sync would be simplified.</span></p></div></body></html>