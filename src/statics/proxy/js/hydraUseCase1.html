<html>
<head>
	<script type="text/JavaScript" src="hydr-german.js"></script>
	<script type="text/JavaScript" src="jquery-1.9.1.js"></script>
	<script>
		var user = "Juan";
		window.onload = function() {
			$("table .service .buttonStart").click(function(obj) {
				var tr = $(this).parents(".service");
				var service = tr.find(".text").val();
				var params = tr.find(".params");
				hydr.client.start(service, user, function(data) {
					var ser = tr.find(".ser").html(JSON.stringify(data));
					var res = tr.find(".res")
					if (data.err == "ok") {
						console.log("Running start ok !!!")
						ser.css("background-color","green");
						var element = document.createElement("input");
					    element.setAttribute("type", "button");
					    element.setAttribute("value", "Invoke");
					    element.onclick = function() {
						    var url = data.srv + "/" + service + params.val();
						    var start_time = new Date().getTime();
						    $.ajax({
								url: url,
							}).done(function ( data ) {
								var json = JSON.parse(data);
								json.request_time = new Date().getTime() - start_time;
								res.html(JSON.stringify(json));
							}).error(function ( data ) {
								res.html("Error");
							});
					    };
					    ser.append(element);
					    element.click();
					} else {
						console.log("Running start error !!!")
						ser.css("background-color","red");
					}
				});
			});
			
			$("table .service .buttonStop").click(function(obj) {
				var tr = $(this).parents(".service");
				var service = tr.find(".text").val();
				tr.find(".ser").html('');
				tr.find(".res").attr('src', "");
				hydr.client.stop(service, user);
			});
		};
	</script>
	<style>
		table {
			width: 100%;
		}
		table td {
			border: solid 1px;
			text-align: center;
		}
		table .res {
			width: 600px;
			height: 200px;
			border: 0;
		}
		
		table .ser {
			min-width: 400px;
		}
	</style>
</head>
<body>
	<table>
		<thead>
			<td>Service</td>
			<td>Server</td>
			<td>Last Answer</td>
		</thead>
		<tbody>
			<tr class="service">
				<td>
					Service name: <input class="text" type="text" value="service_time"><br>
					Service params: <input class="params" type="text" value=""><br>
	 				<input class="buttonStart" type="button" value="Start service">
	 				<input class="buttonStop" type="button" value="Stop service">
				</td><td>
					<div class="ser"> </div>
				</td><td>
					<div class="res"> </div>
					<!--<iframe class="res" src=""> </iframe>-->
				</td>
			</tr>
			<tr class="service">
				<td>
					Service name: <input class="text" type="text" value="service_sum"><br>
					Service params: <input class="params" type="text" value="/2/3"><br>
	 				<input class="buttonStart" type="button" value="Start service">
	 				<input class="buttonStop" type="button" value="Stop service">
				</td><td>
					<div class="ser"> </div>
				</td><td>
					<div class="res"> </div>
				</td>
			</tr>
			<tr class="service">
				<td>
					Service name: <input class="text" type="text" value="service_uuid"><br>
					Service params: <input class="params" type="text" value=""><br>
	 				<input class="buttonStart" type="button" value="Start service">
	 				<input class="buttonStop" type="button" value="Stop service">
				</td><td>
					<div class="ser"> </div>
				</td><td>
					<div class="res"> </div>
				</td>
			</tr>
		</tbody>
	</table> 
</body>
</html>